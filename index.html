<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片库 - 航通社</title>
    <style>
        /* * 航通社全站统一样式系统
         * 包含深色模式变量适配
         * 已移除所有滑动/折叠动画，仅保留颜色渐变
         */

        /* ===== 基础变量定义 ===== */
        :root {
            /* 浅色模式变量 */
            --primary-blue: #3182CE;
            --primary-blue-hover: #2B6CB0;
            
            --bg-primary: #F7FAFC;      /* 页面大背景 */
            --bg-secondary: #EDF2F7;    /* 次级背景 */
            --bg-white: #FFFFFF;        /* 卡片背景 */
            --bg-hover: #EDF2F7;        /* 悬停背景 */
            --bg-active: #E2E8F0;       /* 点击背景 */
            
            --text-primary: #1A202C;
            --text-secondary: #718096;
            --text-muted: #A0AEC0;
            --text-white: #FFFFFF;
            
            --border-light: #E2E8F0;
            --border-medium: #CBD5E0;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-full: 9999px;
            
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        /* 深色模式变量覆盖 */
        html[data-theme="dark"] {
            --primary-blue: #347df8;
            --primary-blue-hover: #4d8fff;
            
            --bg-primary: #0D1117;
            --bg-secondary: #21262d;
            --bg-white: #161b22;
            --bg-hover: #21262d;
            --bg-active: #30363d;
            
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --text-white: #0D1117;
            
            --border-light: #30363d;
            --border-medium: #30363d;
            
            --shadow-sm: 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* ===== 全局重置 ===== */
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-family);
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            /* 仅保留颜色过渡，去除布局过渡 */
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        a { text-decoration: none; color: inherit; }
        button { font-family: inherit; }

        /* ===== 布局结构 ===== */
        .gallery-container {
            display: flex;
            min-height: 100vh;
        }

        /* 侧边栏 */
        .gallery-sidebar {
            width: 280px;
            background-color: var(--bg-white);
            border-right: 1px solid var(--border-light);
            box-shadow: var(--shadow-md);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
        }

        .gallery-sidebar-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-light);
            background-color: var(--bg-white);
            flex-shrink: 0;
        }

        .sidebar-logo-image {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            object-fit: cover;
        }

        .gallery-sidebar-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .gallery-sidebar-title:hover { color: var(--primary-blue); }

        .gallery-sidebar-body {
            padding: var(--space-4);
            overflow-y: auto;
            flex: 1;
        }

        /* 年份/月份选择器 */
        .date-selector { margin-bottom: var(--space-6); }
        
        .date-selector-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            padding: 0 var(--space-2);
        }

        /* 开关组件 */
        .original-image-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-4);
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            cursor: pointer;
            user-select: none;
        }

        .toggle-text { font-size: 0.875rem; font-weight: 500; }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .toggle-slider {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--border-medium);
            border-radius: var(--radius-full);
            transition: background-color 0.2s; /* 仅保留开关颜色的过渡 */
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px; width: 20px;
            left: 2px; bottom: 2px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s; /* 滑块位置过渡 */
            box-shadow: var(--shadow-sm);
        }

        .toggle-switch input:checked + .toggle-slider { background-color: var(--primary-blue); }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(20px); }

        /* 年份折叠面板 */
        .year-section {
            margin-bottom: var(--space-4);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background-color: var(--bg-white);
            overflow: hidden;
        }

        .year-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            padding: 0 var(--space-6);
            background-color: var(--bg-white);
            cursor: pointer;
            user-select: none;
        }

        .year-header:hover { background-color: var(--bg-hover); }
        .year-header.expanded {
            background-color: var(--bg-hover);
            border-bottom: 1px solid var(--border-light);
        }

        .year-title { font-size: 1.125rem; font-weight: 600; }

        .year-icon {
            width: 24px; height: 24px;
            color: var(--text-secondary);
            /* 去除旋转动画 */
        }

        .year-icon.collapsed { transform: rotate(-90deg); }
        .year-icon.expanded { transform: rotate(0deg); }

        /* 月份网格 */
        .month-grid {
            display: none; /* 默认隐藏 */
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
            padding: var(--space-4);
        }

        /* 状态类控制显示 */
        .month-grid.expanded { display: grid; }

        .month-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            background-color: var(--bg-white);
            font-size: 0.875rem;
            cursor: pointer;
        }

        .month-btn:hover { background-color: var(--bg-hover); border-color: var(--border-medium); }
        
        .month-btn.active {
            background-color: var(--primary-blue);
            color: #FFFFFF;
            border-color: var(--primary-blue);
        }
        
        .month-btn.active:hover { background-color: var(--primary-blue-hover); }
        
        .month-btn.disabled {
            color: var(--text-muted);
            border-color: transparent;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* 主内容区 */
        .gallery-main {
            flex: 1;
            margin-left: 280px; /* 留出侧边栏宽度 */
            padding: var(--space-8);
            overflow-y: auto;
            height: 100vh;
        }

        /* 日期条目（每天的照片组） */
        .date-item {
            margin-bottom: var(--space-4);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background-color: var(--bg-white);
            overflow: hidden;
        }

        .date-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            padding: 0 var(--space-6);
            background-color: var(--bg-white);
            cursor: pointer;
            user-select: none;
        }

        .date-header:hover { background-color: var(--bg-hover); }
        .date-header.expanded {
            background-color: var(--bg-hover);
            border-bottom: 1px solid var(--border-light);
        }

        .date-title { font-size: 1.125rem; font-weight: 600; }

        .date-icon {
            width: 24px; height: 24px;
            color: var(--text-secondary);
        }
        .date-icon.collapsed { transform: rotate(-90deg); }
        .date-icon.expanded { transform: rotate(0deg); }

        /* 照片容器 */
        .photos-grid {
            display: none; /* 默认隐藏，无高度动画 */
            background-color: var(--bg-white);
            padding: var(--space-6);
        }

        .photos-grid.expanded {
            display: block; /* 直接显示，不限制高度 */
        }

        .photos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--space-4);
        }

        .photo-item {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
        }

        .photo-item:hover {
            box-shadow: var(--shadow-md);
            /* 仅保留微小的悬停位移，如果不想要可以删掉下面这行 */
            transform: translateY(-2px); 
            transition: transform 0.2s;
        }

        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .empty-state {
            padding: var(--space-8);
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
        }

        .copyright {
            padding: var(--space-6);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.75rem;
            border-top: 1px solid var(--border-light);
            margin-top: auto;
        }

        /* 加载动画 */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            color: var(--text-muted);
        }
        .loading::after {
            content: '';
            width: 20px; height: 20px;
            border: 2px solid var(--border-light);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== 响应式适配 ===== */
        @media (max-width: 768px) {
            .gallery-container { flex-direction: column; }
            
            /* 移动端侧边栏默认隐藏 */
            .gallery-sidebar {
                left: -100%;
                transition: left 0.3s ease; /* 侧边栏滑出动画保留，否则太生硬 */
            }
            .gallery-sidebar.active { left: 0; }
            
            .gallery-main {
                width: 100%;
                margin-left: 0;
                padding: var(--space-4);
                padding-top: 72px; /* 给顶部栏留空 */
            }

            .mobile-header {
                display: flex;
                position: fixed;
                top: 0; left: 0; right: 0;
                z-index: 999;
                background-color: var(--bg-white);
                border-bottom: 1px solid var(--border-light);
                height: 64px;
                align-items: center;
                justify-content: space-between;
                padding: 0 var(--space-4);
            }

            .mobile-header-logo { display: flex; align-items: center; gap: 10px; }
            .logo-image { width: 40px; height: 40px; border-radius: 50%; }
            .logo-text { font-weight: 600; font-size: 1.125rem; }

            .hamburger-button {
                background: none; border: none;
                display: flex; flex-direction: column; gap: 4px;
                cursor: pointer;
            }
            .hamburger-line {
                width: 24px; height: 2px;
                background-color: var(--text-primary);
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background-color: rgba(0,0,0,0.5);
                z-index: 99;
            }
            .sidebar-overlay.active { display: block; }

            .gallery-sidebar-header { display: none; } /* 移动端侧边栏不显示Logo头 */
        }
        
        @media (min-width: 769px) {
            .mobile-header, .sidebar-overlay { display: none !important; }
        }
    </style>
</head>
<body>
    <!-- 移动端顶部栏 -->
    <div class="mobile-header">
        <div class="mobile-header-logo">
            <a href="https://lishuhang.me/" target="_blank">
                <img src="assets/logo.svg" alt="Logo" class="logo-image">
            </a>
            <span class="logo-text">图片库</span>
        </div>
        <button class="hamburger-button" id="hamburgerButton" aria-label="菜单">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
    </div>

    <!-- 移动端遮罩 -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="gallery-container">
        <!-- 侧边栏 -->
        <aside class="gallery-sidebar" id="gallerySidebar">
            <div class="gallery-sidebar-header">
                <a href="https://lishuhang.me/" target="_blank">
                    <img src="assets/logo.svg" alt="Logo" class="sidebar-logo-image">
                </a>
                <span class="gallery-sidebar-title">图片库</span>
            </div>
            
            <div class="gallery-sidebar-body">
                <div class="date-selector">
                    <!-- 开关控制区 -->
                    <div class="original-image-toggle">
                        <label class="toggle-label">
                            <span class="toggle-text">原图预览</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="originalImageToggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>

                    <div class="original-image-toggle" style="margin-top: 10px;">
                        <label class="toggle-label">
                            <span class="toggle-text">深色模式</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>
                    
                    <label class="date-selector-label" style="margin-top: 20px;">选择日期</label>
                    
                    <!-- 动态生成的年份列表 -->
                    <div id="yearMonthContainer">
                        <div class="loading">正在加载索引...</div>
                    </div>
                </div>

                <div class="copyright">© Li Shuhang</div>
            </div>
        </aside>

        <!-- 主展示区 -->
        <main class="gallery-main">
            <div id="galleryContent">
                <div class="loading" id="loadingIndicator">正在初始化...</div>
            </div>
        </main>
    </div>

    <script>
        // 核心状态管理
        let currentYear = ''; 
        let currentMonth = '';
        let photosData = null;
        let availableMonths = new Set(); // 格式: "YYYYMM"

        // 初始化入口
        async function initGallery() {
            initDarkMode();
            await loadAvailableMonths();
            determineInitialDate();
            generateYearMonthSelector();
            bindEvents();
            
            // 如果确定了日期，加载数据
            if (currentYear && currentMonth) {
                loadPhotos(currentYear, currentMonth);
                // 默认展开当前年
                toggleYear(currentYear);
                // 高亮当前月
                setTimeout(() => updateActiveButtonState(currentYear, currentMonth), 0);
            }
        }

        // 1. 加载数据索引
        async function loadAvailableMonths() {
            const startYear = 2007;
            const endYear = new Date().getFullYear();
            const checkPromises = [];
            
            for (let year = startYear; year <= endYear; year++) {
                for (let month = 1; month <= 12; month++) {
                    const yStr = year.toString();
                    const mStr = month.toString().padStart(2, '0');
                    const path = `data/${yStr}${mStr}.json`;
                    
                    checkPromises.push(
                        fetch(path, { method: 'HEAD' })
                            .then(res => { if (res.ok) availableMonths.add(`${yStr}${mStr}`); })
                            .catch(() => {})
                    );
                }
            }
            await Promise.all(checkPromises);
        }

        // 2. 决定初始显示日期
        function determineInitialDate() {
            const now = new Date();
            const y = now.getFullYear().toString();
            const m = (now.getMonth() + 1).toString().padStart(2, '0');
            const key = y + m;

            if (availableMonths.has(key)) {
                currentYear = y; currentMonth = m;
            } else {
                // 倒序找最近的一个月
                const sorted = Array.from(availableMonths).sort((a, b) => b - a);
                if (sorted.length > 0) {
                    currentYear = sorted[0].substring(0, 4);
                    currentMonth = sorted[0].substring(4, 6);
                }
            }
        }

        // 3. 渲染侧边栏年份
        function generateYearMonthSelector() {
            const container = document.getElementById('yearMonthContainer');
            const years = new Set();
            availableMonths.forEach(ym => years.add(ym.substring(0, 4)));
            if (years.size === 0) years.add(new Date().getFullYear().toString());

            const sortedYears = Array.from(years).sort((a, b) => b - a);
            
            let html = '';
            sortedYears.forEach(year => {
                html += `
                    <div class="year-section">
                        <div class="year-header" data-year="${year}">
                            <span class="year-title">${year}年</span>
                            <svg class="year-icon collapsed" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-3.2 3.2c-.2.2-.4.3-.6.3Z"/>
                            </svg>
                        </div>
                        <div class="month-grid" id="months-${year}">`;
                
                for (let m = 1; m <= 12; m++) {
                    const mStr = m.toString().padStart(2, '0');
                    const isAvail = availableMonths.has(year + mStr);
                    const cls = isAvail ? 'month-btn' : 'month-btn disabled';
                    const tag = isAvail ? 'div' : 'div'; // 统一用div配合CSS click事件
                    html += `<div class="${cls}" data-year="${year}" data-month="${mStr}">${m}</div>`;
                }
                
                html += `</div></div>`;
            });
            container.innerHTML = html;
        }

        // 4. 事件绑定
        function bindEvents() {
            // 年份点击
            document.querySelectorAll('.year-header').forEach(h => {
                h.addEventListener('click', () => toggleYear(h.dataset.year));
            });

            // 月份点击
            document.querySelectorAll('.month-btn:not(.disabled)').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const y = e.target.dataset.year;
                    const m = e.target.dataset.month;
                    selectMonth(y, m);
                });
            });

            // 日期条目点击 (事件委托)
            document.getElementById('galleryContent').addEventListener('click', (e) => {
                const header = e.target.closest('.date-header');
                if (header) toggleDatePhotos(header);
            });

            // 移动端菜单
            const burger = document.getElementById('hamburgerButton');
            const overlay = document.getElementById('sidebarOverlay');
            if (burger) {
                burger.addEventListener('click', () => {
                    document.getElementById('gallerySidebar').classList.add('active');
                    overlay.classList.add('active');
                });
            }
            if (overlay) {
                overlay.addEventListener('click', () => {
                    document.getElementById('gallerySidebar').classList.remove('active');
                    overlay.classList.remove('active');
                });
            }

            // 原图开关
            document.getElementById('originalImageToggle').addEventListener('change', reloadExpandedPhotos);
        }

        // 交互逻辑
        function toggleYear(year) {
            const header = document.querySelector(`.year-header[data-year="${year}"]`);
            const grid = document.getElementById(`months-${year}`);
            const icon = header.querySelector('.year-icon');
            
            // 简单的切换类名，CSS中display:none/grid控制，无动画
            const isExpanded = grid.classList.contains('expanded');
            
            // 先关闭所有
            document.querySelectorAll('.month-grid').forEach(el => el.classList.remove('expanded'));
            document.querySelectorAll('.year-header').forEach(el => el.classList.remove('expanded'));
            document.querySelectorAll('.year-icon').forEach(el => {
                el.classList.remove('expanded');
                el.classList.add('collapsed');
            });

            if (!isExpanded) {
                grid.classList.add('expanded');
                header.classList.add('expanded');
                icon.classList.remove('collapsed');
                icon.classList.add('expanded');
            }
        }

        function selectMonth(y, m) {
            currentYear = y; currentMonth = m;
            updateActiveButtonState(y, m);
            loadPhotos(y, m);
            // 移动端选完自动收起菜单
            if (window.innerWidth <= 768) {
                document.getElementById('sidebarOverlay').click();
            }
        }

        function updateActiveButtonState(y, m) {
            document.querySelectorAll('.month-btn').forEach(b => b.classList.remove('active'));
            const target = document.querySelector(`.month-btn[data-year="${y}"][data-month="${m}"]`);
            if (target) target.classList.add('active');
        }

        // 加载照片列表
        async function loadPhotos(y, m) {
            const content = document.getElementById('galleryContent');
            content.innerHTML = '<div class="loading">加载中...</div>';
            
            try {
                const res = await fetch(`data/${y}${m}.json`);
                if (!res.ok) throw new Error();
                photosData = await res.json();
                renderPhotosList();
            } catch (e) {
                content.innerHTML = '<div class="empty-state">暂无数据</div>';
            }
        }

        function renderPhotosList() {
            const content = document.getElementById('galleryContent');
            if (!photosData || !photosData.photos) {
                content.innerHTML = '<div class="empty-state">本月无照片</div>';
                return;
            }

            let html = '';
            Object.keys(photosData.photos).sort().forEach(day => {
                const dateStr = `${photosData.month}/${day}`;
                html += `
                    <div class="date-item">
                        <div class="date-header" data-date="${day}">
                            <span class="date-title">${dateStr}</span>
                            <svg class="date-icon collapsed" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-3.2 3.2c-.2.2-.4.3-.6.3Z"/>
                            </svg>
                        </div>
                        <div class="photos-grid" data-date="${day}">
                            <div class="photos-container" id="photos-${day}"></div>
                        </div>
                    </div>`;
            });
            content.innerHTML = html;
        }

        function toggleDatePhotos(header) {
            const day = header.dataset.date;
            const grid = document.querySelector(`.photos-grid[data-date="${day}"]`);
            const container = document.getElementById(`photos-${day}`);
            const icon = header.querySelector('.date-icon');
            
            const isExpanded = grid.classList.contains('expanded');

            if (isExpanded) {
                grid.classList.remove('expanded');
                header.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.classList.add('collapsed');
            } else {
                grid.classList.add('expanded');
                header.classList.add('expanded');
                icon.classList.remove('collapsed');
                icon.classList.add('expanded');
                
                // 懒加载图片 DOM
                if (container.children.length === 0) {
                    renderDayImages(day, container);
                }
            }
        }

        function renderDayImages(day, container) {
            const list = photosData.photos[day];
            if (!list) return;

            const useOriginal = document.getElementById('originalImageToggle').checked;
            let html = '';
            
            list.forEach(file => {
                // 简单的 URL 替换逻辑
                let url = photosData.base_url
                    .replace('{year}', photosData.year)
                    .replace('{month}', photosData.month)
                    .replace('{day}', day)
                    .replace('{user_id}', photosData.user_id) + file;
                
                // 缩略图服务 (Images.weserv.nl)
                const thumb = `https://images.weserv.nl/?url=${encodeURIComponent(url)}&w=300&h=300&output=jpg&q=80&t=square`;
                const view = useOriginal ? url : `https://images.weserv.nl/?url=${encodeURIComponent(url)}&output=jpg&q=80`;

                html += `
                    <div class="photo-item">
                        <a href="${view}" target="_blank">
                            <img src="${thumb}" loading="lazy" alt="">
                        </a>
                    </div>`;
            });
            container.innerHTML = html;
        }

        function reloadExpandedPhotos() {
            document.querySelectorAll('.photos-grid.expanded').forEach(grid => {
                const day = grid.dataset.date;
                const container = document.getElementById(`photos-${day}`);
                if (container) renderDayImages(day, container);
            });
        }

        // 深色模式
        function initDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            const saved = localStorage.getItem('theme');
            const sysDark = window.matchMedia('(prefers-color-scheme: dark)');

            const apply = (theme) => {
                document.documentElement.setAttribute('data-theme', theme);
                toggle.checked = (theme === 'dark');
            };

            if (saved) {
                apply(saved);
            } else {
                apply(sysDark.matches ? 'dark' : 'light');
            }

            toggle.addEventListener('change', (e) => {
                const t = e.target.checked ? 'dark' : 'light';
                apply(t);
                localStorage.setItem('theme', t);
            });
        }

        // 启动
        document.addEventListener('DOMContentLoaded', initGallery);
    </script>
</body>
</html>