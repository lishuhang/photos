<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片库 - 航通社</title>
    <!-- 已移除外部 CSS 链接，样式表已内联并优化 -->
    <style>
        /* * 航通社全站统一样式系统
         * 基于 Chakra UI 设计语言重新设计
         * 包含深色模式变量适配
         */

        /* ===== 基础变量定义 ===== */
        :root {
            /* * 默认浅色模式 (Light Mode) 变量 
             * 对应 Chakra UI 默认配色
             */
            --primary-blue: #3182CE;
            --primary-blue-light: #4299E1;
            --primary-blue-dark: #2C5282;
            --primary-blue-hover: #2B6CB0;
            
            --bg-primary: #F7FAFC;      /* 页面大背景 */
            --bg-secondary: #EDF2F7;    /* 次级背景（如表头、开关底色） */
            --bg-tertiary: #E2E8F0;     /* 三级背景 */
            --bg-white: #FFFFFF;        /* 卡片、侧边栏背景 */
            --bg-hover: #EDF2F7;        /* 悬停背景 */
            --bg-active: #E2E8F0;       /* 点击/激活背景 */
            
            --text-primary: #1A202C;
            --text-secondary: #718096;
            --text-muted: #A0AEC0;
            --text-white: #FFFFFF;
            
            --border-light: #E2E8F0;
            --border-medium: #CBD5E0;
            --border-dark: #A0AEC0;
            
            --shadow-xs: 0 0 0 1px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* 其他非颜色变量保持不变 */
            --radius-none: 0;
            --radius-sm: 0.125rem;
            --radius-base: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-full: 9999px;
            
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-md: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            
            --line-height-normal: 1.5;
            --line-height-short: 1.375;
            --line-height-tall: 1.625;
            
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            --duration-ultra-fast: 50ms;
            --duration-faster: 100ms;
            --duration-fast: 150ms;
            --duration-normal: 200ms;
            --duration-slow: 300ms;
            --duration-slower: 400ms;
            --duration-ultra-slow: 500ms;
        }

        /* * 深色模式 (Dark Mode) 变量覆盖
         * 只需要重新定义颜色变量，无需编写具体的 CSS 规则
         * 配色参考 GitHub Dark Dimmed 风格
         */
        html[data-theme="dark"] {
            /* 蓝色系调整为更适合深色的高亮蓝 */
            --primary-blue: #347df8;
            --primary-blue-light: #4d8fff;
            --primary-blue-dark: #2768d9;
            --primary-blue-hover: #4d8fff;
            
            /* 背景色系 - 核心改动 */
            --bg-primary: #0D1117;      /* 最深背景 (Body) */
            --bg-secondary: #21262d;    /* 次级背景 */
            --bg-tertiary: #30363d;     /* 三级背景 */
            --bg-white: #161b22;        /* 卡片/侧边栏背景 (原 White) */
            --bg-hover: #21262d;        /* 悬停 */
            --bg-active: #30363d;       /* 激活 */
            
            /* 文字色系 */
            --text-primary: #e6edf3;    /* 主文字 (近白) */
            --text-secondary: #8b949e;  /* 次级文字 (灰) */
            --text-muted: #6e7681;      /* 弱化文字 (深灰) */
            --text-white: #0D1117;      /* 反白文字 (用于蓝色按钮上的文字) */
            
            /* 边框色系 */
            --border-light: #30363d;
            --border-medium: #30363d;
            --border-dark: #6e7681;

            /* 阴影调整 (深色模式阴影通常较弱或不明显，这里保持原值或微调) */
            --shadow-xs: 0 0 0 1px rgba(255, 255, 255, 0.1); /* 微调边框阴影 */
        }

        /* ===== 基础重置和全局样式 ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-md);
            line-height: var(--line-height-normal);
            color: var(--text-primary);
            background-color: var(--bg-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color var(--duration-normal) ease, color var(--duration-normal) ease;
        }

        /* ===== 通用组件样式 ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-2) var(--space-4);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            line-height: var(--line-height-short);
            text-decoration: none;
            cursor: pointer;
            transition: all var(--duration-normal) ease;
            user-select: none;
            white-space: nowrap;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.6);
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: #FFFFFF; /* 强制白色，避免受 text-primary 影响 */
            border-color: var(--primary-blue);
        }

        .btn-primary:hover {
            background-color: var(--primary-blue-hover);
            border-color: var(--primary-blue-hover);
        }

        .btn-primary:active {
            background-color: var(--primary-blue-dark);
            border-color: var(--primary-blue-dark);
        }

        .btn-secondary {
            background-color: var(--bg-white);
            color: var(--text-primary);
            border-color: var(--border-medium);
        }

        .btn-secondary:hover {
            background-color: var(--bg-hover);
        }

        /* ===== 图片库专用样式 ===== */

        /* 主容器 */
        .gallery-container {
            display: flex;
            min-height: 100vh;
            background-color: var(--bg-primary);
            transition: background-color var(--duration-normal) ease;
        }

        /* 侧边栏 */
        .gallery-sidebar {
            width: 280px;
            background-color: var(--bg-white);
            border-right: 1px solid var(--border-light);
            box-shadow: var(--shadow-md);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
        }

        .gallery-sidebar-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-6);
            border-bottom: 1px solid var(--border-light);
            background-color: var(--bg-white);
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
            transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
        }

        .sidebar-logo-image {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            object-fit: cover;
            flex-shrink: 0;
            transition: transform var(--duration-fast) ease;
        }

        .sidebar-logo-image:hover {
            transform: scale(1.05);
        }

        .gallery-sidebar-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            text-decoration: none;
            transition: color var(--duration-fast) ease;
        }

        .gallery-sidebar-title:hover {
            color: var(--primary-blue);
        }

        .gallery-sidebar-body {
            padding: var(--space-4);
            overflow-y: auto;
            flex: 1;
        }

        /* 年份月份选择器 */
        .date-selector {
            margin-bottom: var(--space-6);
        }

        /* 开关样式 */
        .original-image-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-4);
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
            transition: background-color var(--duration-normal) ease;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            cursor: pointer;
            user-select: none;
        }

        .toggle-text {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle-switch input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .toggle-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-medium);
            border-radius: var(--radius-full);
            transition: background-color var(--duration-normal) ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            border-radius: 50%;
            transition: transform var(--duration-normal) ease;
            box-shadow: var(--shadow-sm);
        }

        .toggle-switch input[type="checkbox"]:checked + .toggle-slider {
            background-color: var(--primary-blue);
        }

        .toggle-switch input[type="checkbox"]:checked + .toggle-slider::before {
            transform: translateX(20px);
        }

        .toggle-switch input[type="checkbox"]:disabled + .toggle-slider {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .date-selector-label {
            display: block;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 var(--space-2);
        }

        /* 年份区域 */
        .year-section {
            margin-bottom: var(--space-4);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background-color: var(--bg-white);
            overflow: hidden;
            transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
        }

        .year-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            padding: 0 var(--space-6);
            background-color: var(--bg-white);
            cursor: pointer;
            transition: background-color var(--duration-fast) ease;
            user-select: none;
            color: var(--text-primary);
        }

        .year-header:hover {
            background-color: var(--bg-hover);
        }

        .year-header:active {
            background-color: var(--bg-active);
        }

        .year-header.expanded {
            background-color: var(--bg-hover);
            border-bottom: 1px solid var(--border-light);
        }

        .year-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            line-height: var(--line-height-short);
        }

        .year-icon {
            width: 24px;
            height: 24px;
            color: var(--text-secondary);
            transition: transform var(--duration-normal) ease;
            flex-shrink: 0;
        }

        .year-icon.collapsed {
            transform: rotate(-90deg);
        }

        .year-icon.expanded {
            transform: rotate(0deg);
        }

        /* 月份网格 */
        .month-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--duration-slow) ease;
        }

        .month-grid.expanded {
            max-height: 300px;
            padding: var(--space-4);
        }

        .month-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 32px;
            padding: 0;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            background-color: var(--bg-white);
            color: var(--text-primary);
            text-decoration: none;
            text-align: center;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            line-height: var(--line-height-short);
            transition: all var(--duration-fast) ease;
            cursor: pointer;
        }

        .month-btn:hover {
            background-color: var(--bg-hover);
            border-color: var(--border-medium);
        }

        .month-btn:active {
            background-color: var(--bg-active);
        }

        .month-btn.active {
            background-color: var(--primary-blue);
            color: #FFFFFF;
            border-color: var(--primary-blue);
        }

        .month-btn.active:hover {
            background-color: var(--primary-blue-hover);
            border-color: var(--primary-blue-hover);
        }

        .month-btn.disabled {
            background-color: transparent;
            color: var(--text-muted);
            border-color: transparent;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* 主内容区 */
        .gallery-main {
            flex: 1;
            margin-left: 280px;
            padding: var(--space-8);
            overflow-y: auto;
            height: 100vh;
            transition: margin-left var(--duration-normal) ease;
        }

        /* 日期条目 */
        .date-item {
            margin-bottom: var(--space-4);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background-color: var(--bg-white);
            overflow: hidden;
            transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
        }

        .date-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            padding: 0 var(--space-6);
            background-color: var(--bg-white);
            cursor: pointer;
            transition: background-color var(--duration-fast) ease;
            user-select: none;
        }

        .date-header:hover {
            background-color: var(--bg-hover);
        }

        .date-header:active {
            background-color: var(--bg-active);
        }

        .date-header.expanded {
            background-color: var(--bg-hover);
            border-bottom: 1px solid var(--border-light);
        }

        .date-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            line-height: var(--line-height-short);
        }

        .date-icon {
            width: 24px;
            height: 24px;
            color: var(--text-secondary);
            transition: transform var(--duration-normal) ease;
            flex-shrink: 0;
        }

        .date-icon.collapsed {
            transform: rotate(-90deg);
        }

        .date-icon.expanded {
            transform: rotate(0deg);
        }

        /* 照片网格 */
        .photos-grid {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--duration-slow) ease;
            background-color: var(--bg-white);
        }

        .photos-grid.expanded {
            max-height: 8000px;
        }

        .photos-container {
            padding: var(--space-6);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--space-4);
        }

        .photo-item {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--duration-normal) ease;
            cursor: pointer;
        }

        .photo-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .photo-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .empty-state {
            padding: var(--space-8);
            text-align: center;
            color: var(--text-muted);
            font-size: var(--font-size-sm);
            font-style: italic;
        }

        /* ===== 响应式设计 ===== */

        /* 移动端适配 */
        @media (max-width: 768px) {
            .gallery-container {
                flex-direction: column;
            }
            
            .gallery-sidebar-header {
                display: none;
            }
            
            .gallery-sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                z-index: 1001;
                transition: left var(--duration-normal) ease;
                box-shadow: var(--shadow-xl);
            }
            
            .gallery-sidebar.active {
                left: 0;
            }
            
            .gallery-sidebar-body {
                overflow-y: auto;
                height: calc(100vh - 64px);
            }
            
            .gallery-main {
                width: 100%;
                margin-left: 0;
                padding: var(--space-4);
                padding-top: 72px;
                height: auto;
            }
            
            .mobile-header {
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 999;
                background-color: var(--bg-white);
                border-bottom: 1px solid var(--border-light);
                box-shadow: var(--shadow-sm);
                padding: var(--space-3) var(--space-4);
                height: 64px;
                align-items: center;
                justify-content: space-between;
                transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
            }
            
            .mobile-header-logo {
                display: flex;
                align-items: center;
                gap: var(--space-3);
            }
            
            .logo-image {
                width: 40px;
                height: 40px;
                border-radius: var(--radius-full);
                object-fit: cover;
            }
            
            .logo-text {
                font-size: var(--font-size-lg);
                font-weight: var(--font-weight-semibold);
                color: var(--text-primary);
                text-decoration: none;
                transition: color var(--duration-fast) ease;
            }
            
            .logo-text:hover {
                color: var(--primary-blue);
            }
            
            .hamburger-button {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: 40px;
                height: 40px;
                background: none;
                border: none;
                cursor: pointer;
                padding: var(--space-2);
                border-radius: var(--radius-md);
                transition: background-color var(--duration-fast) ease;
            }
            
            .hamburger-button:hover {
                background-color: var(--bg-hover);
            }
            
            .hamburger-button:active {
                background-color: var(--bg-active);
            }
            
            .hamburger-line {
                width: 24px;
                height: 2px;
                background-color: var(--text-primary);
                border-radius: var(--radius-full);
                transition: all var(--duration-normal) ease;
                margin: 3px 0;
            }
            
            .hamburger-button.active .hamburger-line:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }
            
            .hamburger-button.active .hamburger-line:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-button.active .hamburger-line:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }
            
            .sidebar-overlay {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                opacity: 0;
                transition: opacity var(--duration-normal) ease;
                pointer-events: none;
            }
            
            .sidebar-overlay.active {
                opacity: 1;
                pointer-events: auto;
            }
            
            .close-button {
                position: fixed;
                top: var(--space-4);
                right: var(--space-4);
                width: 48px;
                height: 48px;
                background-color: var(--bg-white);
                border: none;
                border-radius: var(--radius-full);
                box-shadow: var(--shadow-lg);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1002;
                opacity: 0;
                pointer-events: none;
                transition: all var(--duration-normal) ease;
                color: var(--text-primary);
            }
            
            .close-button:hover {
                background-color: var(--bg-hover);
                transform: scale(1.05);
            }
            
            .close-button:active {
                background-color: var(--bg-active);
                transform: scale(0.95);
            }
            
            .sidebar-overlay.active .close-button {
                opacity: 1;
                pointer-events: auto;
            }
            
            .photos-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: var(--space-3);
            }
            
            .photo-item img {
                height: 120px;
            }
            
            .date-header {
                height: 48px;
                padding: 0 var(--space-4);
            }
            
            .date-title {
                font-size: var(--font-size-md);
            }
            
            .date-icon {
                width: 20px;
                height: 20px;
            }
        }

        /* 桌面端隐藏移动端元素 */
        @media (min-width: 769px) {
            .mobile-header,
            .sidebar-overlay {
                display: none !important;
            }
        }

        /* 大屏幕优化 */
        @media (min-width: 1440px) {
            .gallery-sidebar {
                width: 320px;
            }
            
            .photos-container {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: var(--space-6);
            }
            
            .photo-item img {
                height: 180px;
            }
        }

        /* ===== 加载状态 ===== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            color: var(--text-muted);
            font-size: var(--font-size-sm);
        }

        .loading::after {
            content: '';
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-light);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-left: var(--space-3);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ===== 版权信息 ===== */
        .copyright {
            padding: var(--space-6);
            text-align: center;
            color: var(--text-muted);
            font-size: var(--font-size-xs);
            border-top: 1px solid var(--border-light);
            background-color: var(--bg-white);
            margin-top: auto;
            transition: background-color var(--duration-normal) ease, border-color var(--duration-normal) ease;
        }

        /* ===== 滚动条样式 ===== */
        .gallery-sidebar::-webkit-scrollbar,
        .gallery-main::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .gallery-sidebar::-webkit-scrollbar-track,
        .gallery-main::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .gallery-sidebar::-webkit-scrollbar-thumb,
        .gallery-main::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: var(--radius-full);
        }

        .gallery-sidebar::-webkit-scrollbar-thumb:hover,
        .gallery-main::-webkit-scrollbar-thumb:hover {
            background: var(--border-dark);
        }

        /* ===== 焦点可见性 ===== */
        *:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- 移动端标题栏 -->
    <div class="mobile-header">
        <div class="mobile-header-logo">
            <a href="https://lishuhang.me/" target="_blank" rel="noopener noreferrer">
                <img src="assets/logo.svg" alt="航通社" class="logo-image">
            </a>
            <a href="/index.html" class="logo-text">图片库</a>
        </div>
        <button class="hamburger-button" id="hamburgerButton" aria-label="打开菜单">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
    </div>
    
    <!-- 移动端遮罩层 -->
    <div class="sidebar-overlay" id="sidebarOverlay">
        <!-- 关闭按钮 -->
        <button class="close-button" id="closeButton" aria-label="关闭菜单">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <div class="gallery-container">
        <!-- 侧边栏 -->
        <aside class="gallery-sidebar" id="gallerySidebar">
            <div class="gallery-sidebar-header">
                <a href="https://lishuhang.me/" target="_blank" rel="noopener noreferrer">
                    <img src="assets/logo.svg" alt="航通社" class="sidebar-logo-image">
                </a>
                <a href="/index.html" class="gallery-sidebar-title">图片库</a>
            </div>
            
            <div class="gallery-sidebar-body">
                <div class="date-selector">
                    <!-- 原图开关 -->
                    <div class="original-image-toggle">
                        <label class="toggle-label">
                            <span class="toggle-text">原图</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="originalImageToggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>

                    <!-- 深色模式开关 -->
                    <div class="original-image-toggle" style="margin-top: 10px;">
                        <label class="toggle-label">
                            <span class="toggle-text">深色模式</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>
                    
                    <label class="date-selector-label" style="margin-top: 20px;">选择年份和月份</label>
                    
                    <!-- 年份和月份将动态生成 -->
                    <div id="yearMonthContainer">
                        <div class="loading" style="text-align: center; padding: 20px; color: #999;">
                            正在检测数据...
                        </div>
                    </div>
                </div>

                <div class="copyright">
                    © Li Shuhang
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="gallery-main">
            <div id="galleryContent">
                <div class="loading" id="loadingIndicator">
                    正在初始化图库...
                </div>
            </div>
        </main>
    </div>

    <script>
        // 全局变量
        // 注意：这里不再硬编码默认值，将在 initGallery 中根据数据动态设置
        let currentYear = ''; 
        let currentMonth = '';
        let photosData = null;
        let availableMonths = new Set(); // 存储所有可用的年月 (格式: "YYYYMM")

        // 初始化函数
        async function initGallery() {
            console.log('Initializing gallery...');
            
            // 初始化深色模式
            initDarkMode();

            // 1. 先加载所有可用的月份索引
            await loadAvailableMonths();
            
            // 2. 核心逻辑修改：决定初始显示的年月
            const now = new Date();
            const realCurrentYear = now.getFullYear().toString();
            const realCurrentMonth = (now.getMonth() + 1).toString().padStart(2, '0');
            const realCurrentKey = `${realCurrentYear}${realCurrentMonth}`;

            console.log(`Real world date: ${realCurrentYear}-${realCurrentMonth}`);

            if (availableMonths.has(realCurrentKey)) {
                // 情况A：当前现实月份有数据，直接显示
                console.log('Current month has data. Loading current.');
                currentYear = realCurrentYear;
                currentMonth = realCurrentMonth;
            } else {
                // 情况B：当前月没数据，寻找最近的有数据的月份
                console.log('Current month empty. Searching for latest available...');
                
                // 将 Set 转为数组并倒序排列 (大 -> 小)
                const sortedKeys = Array.from(availableMonths).sort((a, b) => b - a);
                
                if (sortedKeys.length > 0) {
                    // 取最大值（即最近的一个月）
                    const latestKey = sortedKeys[0];
                    currentYear = latestKey.substring(0, 4);
                    currentMonth = latestKey.substring(4, 6);
                    console.log(`Fallback to latest available: ${currentYear}-${currentMonth}`);
                } else {
                    // 情况C：完全没有任何数据（极端情况）
                    currentYear = realCurrentYear;
                    currentMonth = realCurrentMonth;
                    console.warn('No data found at all.');
                }
            }

            // 3. UI 渲染
            generateYearMonthSelector();
            bindEvents();
            
            // 4. 加载确定的月份数据
            if (currentYear && currentMonth) {
                loadPhotos(currentYear, currentMonth);
                // 自动展开对应的年份栏
                toggleYear(currentYear);
                // 高亮对应的月份按钮 (因为 generateYearMonthSelector 已经运行，需要手动触发高亮状态)
                setTimeout(() => {
                    updateActiveButtonState(currentYear, currentMonth);
                }, 0);
            }
            
            console.log('Gallery initialized successfully');
        }

        // 加载所有可用的月份数据
        async function loadAvailableMonths() {
            console.log('Loading available months...');
            
            // 定义可能的年份和月份范围
            const startYear = 2007;
            // 修改：结束年份动态获取当前年份，确保跨年可用
            const endYear = new Date().getFullYear(); 
            
            // 遍历所有可能的年月组合，检查文件是否存在
            const checkPromises = [];
            for (let year = startYear; year <= endYear; year++) {
                for (let month = 1; month <= 12; month++) {
                    const yearStr = year.toString();
                    const monthStr = month.toString().padStart(2, '0');
                    const jsonPath = `data/${yearStr}${monthStr}.json`;
                    
                    checkPromises.push(
                        fetch(jsonPath, { method: 'HEAD' })
                            .then(response => {
                                if (response.ok) {
                                    availableMonths.add(`${yearStr}${monthStr}`);
                                }
                            })
                            .catch(() => {
                                // 文件不存在，忽略
                            })
                    );
                }
            }
            
            await Promise.all(checkPromises);
            console.log('Available months loaded:', availableMonths.size, availableMonths);
        }

        // 生成年份和月份选择器
        function generateYearMonthSelector() {
            const container = document.getElementById('yearMonthContainer');
            
            // 从可用月份中提取年份
            const years = new Set();
            availableMonths.forEach(yearMonth => {
                const year = yearMonth.substring(0, 4);
                years.add(year);
            });
            
            // 如果 years 为空（可能是首次使用或无数据），至少显示当前年份
            if (years.size === 0) {
                years.add(new Date().getFullYear().toString());
            }

            // 按年份倒序排列
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            
            let html = '';
            sortedYears.forEach(year => {
                html += `
                    <div class="year-section">
                        <div class="year-header" data-year="${year}">
                            <span class="year-title">${year}年</span>
                            <svg class="year-icon collapsed" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-3.2 3.2c-.2.2-.4.3-.6.3Z"/>
                            </svg>
                        </div>
                        <div class="month-grid" id="months-${year}">
                `;
                
                // 生成12个月份按钮
                for (let month = 1; month <= 12; month++) {
                    const monthStr = month.toString().padStart(2, '0');
                    const yearMonth = `${year}${monthStr}`;
                    const isAvailable = availableMonths.has(yearMonth);
                    // 注意：这里不再生成 active 类，统一在 init 或点击时处理
                    const disabledClass = isAvailable ? '' : ' disabled';
                    
                    if (isAvailable) {
                        html += `<a href="#" class="month-btn${disabledClass}" data-year="${year}" data-month="${monthStr}">${month}</a>`;
                    } else {
                        html += `<span class="month-btn${disabledClass}">${month}</span>`;
                    }
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function bindEvents() {
            // 年份展开/折叠
            document.querySelectorAll('.year-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const year = e.currentTarget.dataset.year;
                    toggleYear(year);
                });
            });

            // 月份选择
            document.querySelectorAll('.month-btn:not(.disabled)').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const year = e.target.dataset.year;
                    const month = e.target.dataset.month;
                    console.log('Month clicked:', year, month);
                    selectMonth(year, month);
                });
            });

            // 移动端汉堡按钮切换
            const hamburgerButton = document.getElementById('hamburgerButton');
            if (hamburgerButton) {
                hamburgerButton.addEventListener('click', () => {
                    toggleMobileSidebar();
                });
            }

            // 移动端遮罩层点击关闭
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', (e) => {
                    if (e.target === sidebarOverlay) {
                        closeMobileSidebar();
                    }
                });
            }

            // 移动端关闭按钮点击关闭
            const closeButton = document.getElementById('closeButton');
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    closeMobileSidebar();
                });
            }

            // 原图开关切换
            const originalImageToggle = document.getElementById('originalImageToggle');
            if (originalImageToggle) {
                originalImageToggle.addEventListener('change', () => {
                    reloadExpandedPhotos();
                });
            }

            // 日期条目展开/折叠（事件委托）
            document.getElementById('galleryContent').addEventListener('click', (e) => {
                const dateHeader = e.target.closest('.date-header');
                if (dateHeader) {
                    toggleDatePhotos(dateHeader);
                }
            });
        }

        function toggleYear(year) {
            const header = document.querySelector(`[data-year="${year}"]`);
            // 防止 header 不存在报错（例如年份数据为空时）
            if (!header) return; 

            const monthGrid = document.getElementById(`months-${year}`);
            const icon = header.querySelector('.year-icon');

            if (monthGrid.classList.contains('expanded')) {
                // 折叠
                monthGrid.classList.remove('expanded');
                header.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.classList.add('collapsed');
            } else {
                // 先关闭其他年份
                document.querySelectorAll('.month-grid.expanded').forEach(grid => {
                    grid.classList.remove('expanded');
                });
                document.querySelectorAll('.year-header.expanded').forEach(h => {
                    h.classList.remove('expanded');
                });
                document.querySelectorAll('.year-icon.expanded').forEach(ic => {
                    ic.classList.remove('expanded');
                    ic.classList.add('collapsed');
                });

                // 展开当前年份
                monthGrid.classList.add('expanded');
                header.classList.add('expanded');
                icon.classList.remove('collapsed');
                icon.classList.add('expanded');
            }
        }

        // 辅助函数：更新选中状态UI
        function updateActiveButtonState(year, month) {
            document.querySelectorAll('.month-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const targetBtn = document.querySelector(`[data-year="${year}"][data-month="${month}"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
        }

        function selectMonth(year, month) {
            // 更新活动状态
            updateActiveButtonState(year, month);

            // 加载照片
            currentYear = year;
            currentMonth = month;
            loadPhotos(year, month);

            // 移动端自动收起侧边栏
            if (window.innerWidth <= 768) {
                closeMobileSidebar();
            }
        }

        function toggleMobileSidebar() {
            const sidebar = document.getElementById('gallerySidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const hamburger = document.getElementById('hamburgerButton');
            
            if (sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                hamburger.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('gallerySidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const hamburger = document.getElementById('hamburgerButton');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            hamburger.classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadPhotos(year, month) {
            console.log('Loading photos for:', year, month);
            
            const galleryContent = document.getElementById('galleryContent');
            
            let loadingIndicator = document.getElementById('loadingIndicator');
            if (!loadingIndicator) {
                galleryContent.innerHTML = '<div class="loading" id="loadingIndicator">正在加载照片...</div>';
                loadingIndicator = document.getElementById('loadingIndicator');
            }
            
            loadingIndicator.style.display = 'flex';
            
            try {
                const jsonPath = `data/${year}${month.padStart(2, '0')}.json`;
                const response = await fetch(jsonPath);
                
                if (!response.ok) {
                    throw new Error('No data available');
                }
                
                photosData = await response.json();
                renderPhotos();
            } catch (error) {
                console.error('加载照片数据失败:', error);
                galleryContent.innerHTML = `
                    <div class="empty-state">
                        <p>暂无 ${year}年${month}月 的照片数据</p>
                        <p>请选择其他月份</p>
                    </div>
                `;
            } finally {
                const finalLoadingIndicator = document.getElementById('loadingIndicator');
                if (finalLoadingIndicator) {
                    finalLoadingIndicator.style.display = 'none';
                }
            }
        }

        function renderPhotos() {
            const galleryContent = document.getElementById('galleryContent');
            
            if (!photosData || !photosData.photos) {
                galleryContent.innerHTML = '<div class="empty-state">暂无照片</div>';
                return;
            }

            let html = '';
            const sortedDates = Object.keys(photosData.photos).sort();

            sortedDates.forEach(date => {
                const photos = photosData.photos[date];
                const dateDisplay = `${photosData.month}/${date}`;
                
                html += `
                    <div class="date-item">
                        <div class="date-header" data-date="${date}">
                            <span class="date-title">${dateDisplay}</span>
                            <svg class="date-icon collapsed" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1.3-.3.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0 .3.3.3.8 0 1.1l-3.2 3.2c-.2.2-.4.3-.6.3Z"/>
                            </svg>
                        </div>
                        <div class="photos-grid" data-date="${date}">
                            <div class="photos-container" id="photos-${date}">
                            </div>
                        </div>
                    </div>
                `;
            });

            galleryContent.innerHTML = html;
        }

        function toggleDatePhotos(dateHeader) {
            const date = dateHeader.dataset.date;
            const photosGrid = document.querySelector(`.photos-grid[data-date="${date}"]`);
            const photosContainer = document.getElementById(`photos-${date}`);
            const icon = dateHeader.querySelector('.date-icon');

            if (photosGrid.classList.contains('expanded')) {
                // 折叠
                photosGrid.classList.remove('expanded');
                dateHeader.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.classList.add('collapsed');
            } else {
                // 展开
                photosGrid.classList.add('expanded');
                dateHeader.classList.add('expanded');
                icon.classList.remove('collapsed');
                icon.classList.add('expanded');

                if (photosContainer.children.length === 0) {
                    loadDatePhotos(date, photosContainer);
                }
            }
        }

        function loadDatePhotos(date, container) {
            if (!photosData || !photosData.photos[date]) {
                container.innerHTML = '<div class="empty-state">这一天没有照片</div>';
                return;
            }

            const photos = photosData.photos[date];
            const baseUrl = photosData.base_url
                .replace('{user_id}', photosData.user_id)
                .replace('{year}', photosData.year)
                .replace('{month}', photosData.month)
                .replace('{day}', date);

            const useOriginal = document.getElementById('originalImageToggle').checked;

            let html = '';
            photos.forEach(filename => {
                const fullUrl = baseUrl + filename;
                const thumbnailUrl = `https://images.weserv.nl/?url=${encodeURIComponent(fullUrl)}&w=300&h=300&output=jpg&q=80&t=square`;
                
                let clickUrl;
                if (useOriginal) {
                    clickUrl = fullUrl;
                } else {
                    clickUrl = `https://images.weserv.nl/?url=${encodeURIComponent(fullUrl)}&output=jpg&q=80`;
                }
                
                html += `
                    <div class="photo-item">
                        <a href="${clickUrl}" target="_blank">
                            <img src="${thumbnailUrl}" alt="照片" loading="lazy">
                        </a>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function reloadExpandedPhotos() {
            const expandedGrids = document.querySelectorAll('.photos-grid.expanded');
            expandedGrids.forEach(grid => {
                const date = grid.dataset.date;
                const photosContainer = document.getElementById(`photos-${date}`);
                if (photosContainer && photosContainer.children.length > 0) {
                    loadDatePhotos(date, photosContainer);
                }
            });
        }

        // ===== 深色模式功能 =====

        function initDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (!darkModeToggle) return;
            
            // 检查用户之前的选择
            const savedTheme = localStorage.getItem('theme');
            
            if (savedTheme) {
                // 如果用户之前选择过，使用保存的设置
                applyTheme(savedTheme);
                darkModeToggle.checked = savedTheme === 'dark';
            } else {
                // 否则跟随系统设置
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = prefersDark ? 'dark' : 'light';
                applyTheme(theme);
                darkModeToggle.checked = prefersDark;
            }
            
            // 监听切换按钮
            darkModeToggle.addEventListener('change', (e) => {
                const theme = e.target.checked ? 'dark' : 'light';
                applyTheme(theme);
                localStorage.setItem('theme', theme);
            });
            
            // 监听系统主题变化（仅当用户未手动设置时）
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    const theme = e.matches ? 'dark' : 'light';
                    applyTheme(theme);
                    darkModeToggle.checked = e.matches;
                }
            });
        }

        // 应用主题
        function applyTheme(theme) {
            // 同时设置html和body的data-theme属性
            document.documentElement.setAttribute('data-theme', theme);
            document.body.setAttribute('data-theme', theme);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGallery);
        } else {
            initGallery();
        }
        
        console.log('Gallery script loaded');
    </script>
</body>
</html>